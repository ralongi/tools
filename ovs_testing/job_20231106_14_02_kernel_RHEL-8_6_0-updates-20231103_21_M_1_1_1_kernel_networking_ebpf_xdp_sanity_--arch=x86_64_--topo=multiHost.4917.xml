
<job retention_tag="60days" user="">
    <whiteboard><![CDATA[(Server/DUT: netqe2.knqe.lab.eng.bos.redhat.com, Client: netqe3.knqe.lab.eng.bos.redhat.com), XDP Sanity test, RHEL-8.6.0-updates-20231103.21, networking/ebpf_xdp/sanity, Client driver: i40e, Server driver: ice, Driver under test: ice ]]></whiteboard>
    <notify>
    </notify>
    <recipeSet priority="Normal">
        <recipe kernel_options="" kernel_options_post="" whiteboard="(Server/DUT: netqe2.knqe.lab.eng.bos.redhat.com, Client: netqe3.knqe.lab.eng.bos.redhat.com), XDP Sanity test, RHEL-8.6.0-updates-20231103.21, networking/ebpf_xdp/sanity, Client driver: i40e, Server driver: ice, Driver under test: ice" ks_meta="harness='restraint-rhts beakerlib' redhat_ca_cert disabled_root_access">
            <autopick random="false" />
            <distroRequires>
                <and>
                    <distro_method op="=" value="nfs" />
                    <distro_name op="=" value="RHEL-8.6.0-updates-20231103.21" />
                    <distro_variant op="=" value="" />
                    <distro_arch op="=" value="x86_64" />
                </and>
                <or>
                </or>
                <not>
                    <or>
                    </or>
                </not>
            </distroRequires>
            <hostRequires>
                <and>
                    <hostname op="like" value="netqe2.knqe.lab.eng.bos.redhat.com" />
                </and>
                <system_type op="=" value="machine" />
            </hostRequires>
            <repos>
            </repos>
            <partitions>
            </partitions>
            <ks_appends>
                <ks_append><![CDATA[
%post --log=/root/my-ks-post.log

verx=$(rpm -E %rhel)
case $verx in
8|9)
	[[ "$verx" = 8 ]] && R8=-RHEL-8
	[[ "$verx" = 9 ]] && stype=-Beta
	read dtype distro <<< $(awk -F/+ '/^baseurl/ {
		for (i=3;i<NF;i++) {
			if ($(i+1) ~ /RHEL-/) {
				d=$(i+1)
				if (d ~ /RHEL-[0-9]$/)
					d=$(i+2)
				print($i, d)
				break
			}
		}
	}' /etc/yum.repos.d/beaker-BaseOS.repo)
	dtype=nightly
	read prefix ver time <<< ${distro//-/ }
	buildrootUrl=http://download.devel.redhat.com/rhel-$verx/$dtype/BUILDROOT-$verx$stype/latest-BUILDROOT-$ver$R8/compose/Buildroot/$(arch)/os
	cat <<-EOF >/etc/yum.repos.d/beaker-buildroot.repo
	[beaker-buildroot]
	name=beaker-buildroot
	baseurl=$buildrootUrl
	enabled=1
	gpgcheck=0
	skip_if_unavailable=1
	EOF
	;;
esac

yum install --setopt=strict=0 -y git patch gcc wget bzip2 screen bc redhat-lsb-core sg3_utils sg3_utils-libs sg3_utils-devel rsyslog python2
yum install --setopt=strict=0 -y libnsl2 libtirpc-devel python2-lxml python3-lxml

#yum update -y pkg1 pkg2 --nogpgcheck --repofrompath=abc,http://x.y.z/path/to/repo
%end
]]>

                </ks_append>
            </ks_appends>
            <task name="/distribution/check-install" role="SERVERS">
                <params>
                    <param name="DISTRO_BUILD" value="RHEL-8.6.0-updates-20231103.21" />
                </params>
            </task>
            <task name="/kernel/networking/ebpf_xdp/sanity" role="SERVERS">
                <fetch url="https://gitlab.cee.redhat.com/kernel-qe/kernel/-/archive/master/kernel-master.tar.bz2#networking/ebpf_xdp/sanity" />
                <params>
                    <param name="DBG_FLAG" value="set -x" />
                    <param name="NAY" value="yes" />
                    <param name="NIC_NUM" value="2" />
                    <param name="NIC_DRIVER" value="ice" />
                    <param name="TEST_DRIVER" value="ice" />
                    <param name="XDP_LOAD_MODE" value="native" />
                    <param name="XDP_TEST_FRAMEWORK" value="beakerlib" />
                    <param name="DISTRO_BUILD" value="RHEL-8.6.0-updates-20231103.21" />
                </params>
            </task>
        </recipe>
        <recipe kernel_options="" kernel_options_post="" whiteboard="(Server/DUT: netqe2.knqe.lab.eng.bos.redhat.com, Client: netqe3.knqe.lab.eng.bos.redhat.com), XDP Sanity test, RHEL-8.6.0-updates-20231103.21, networking/ebpf_xdp/sanity, Client driver: i40e, Server driver: ice, Driver under test: ice" ks_meta="harness='restraint-rhts beakerlib' redhat_ca_cert disabled_root_access">
            <autopick random="false" />
            <distroRequires>
                <and>